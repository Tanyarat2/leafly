<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leafly - Eco Phone Cases</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <!-- Navbar -->
  <nav>
    <div class="navbar">
      <a href="/home"><img src="home.png" alt="Menu"></a>
      <span class="search-icon"><a href="/search"><img src="search.png"></a></span>
    </div>
  </nav>

  <!-- Header -->
  <div class="header">
    <img src="Logo.png" alt="Menu">
    <p class="tagline">"Leafly: Eco-Friendly Solutions for Daily Life, Inspired by Nature, Crafted from Recyclables."
    </p>
  </div>

  <!-- Product Section -->
  <div class="product-container" id="product-container"></div>

  <!-- GOOGLE MAP -->
  <h2>Google Maps ร้านของเราไรก้ว่าไป</h2>
  <div id="map" style="height: 500px; width: 100%;"></div>


  <!-- FOOTER -->
  <footer>
    <div class="footer">
      <div class="footer-column">
        <h3><a href="/team">Samote</a></h3>
        <h4>About us:</h4>
        <p>Samote is a passionate group of university students on a mission to make the world a better place—one
          innovative idea at a time!</p>
      </div>
      <div class="footer-column">
        <h3>Leafly</h3>
        <h4>What is Leafly:</h4>
        <p>Leafly crafts sustainable phone cases from recycled plastics, reinvesting profits to support the community.
        </p>
      </div>
      <div class="footer-column">
        <div class="last-footer">
          <h1>Leafly <br> by <br> Samote</h1>
          <h5><a href="/admin-page"><br>for Administrator</a></h5>
        </div>
      </div>
    </div>
  </footer>

  <script>
    function initMap() {
      console.log("initMap function called");

      // กำหนดพิกัด Leafly Store (สินธร มหิดล)
      const leaflyStore = { lat: 13.7947, lng: 100.3252 };

      // สร้างแผนที่
      const map = new google.maps.Map(document.getElementById("map"), {
        center: leaflyStore,
        zoom: 16,
      });

      // ปักหมุด
      const marker = new google.maps.Marker({
        position: leaflyStore,
        map: map,
        title: "Leafly Store",
      });

      // กล่องข้อความเมื่อคลิกหมุด
      const infowindow = new google.maps.InfoWindow({
        content: "<strong>Leafly Store @ Salaya</strong>",
      });

      // เปิดกล่องข้อความเมื่อคลิกที่หมุด
      marker.addListener("click", () => {
        infowindow.open(map, marker);
      });
    }

    // ทำให้ initMap เป็น global function
    window.initMap = initMap;

    // ดึงข้อมูลสินค้าตอนโหลดหน้า
    function fetchProducts() {
      fetch('http://localhost:4000/api/products')
        .then(response => response.json())
        .then(products => {
          console.log('Products:', products);
          const productContainer = document.getElementById('product-container');
          const mimeType = 'image/jpeg';
          const seenNames = new Set();

          const samoteProducts = products
            .filter(product => product.Collection === "Samote")
            .map(product => {
              if (product.Product_Img && !product.Product_Img.startsWith('data:image')) {
                product.Product_Img = `data:${mimeType};base64,${product.Product_Img}`;
              }
              return product;
            })
            .filter(product => {
              if (seenNames.has(product.Product_Name)) {
                return false;
              }
              seenNames.add(product.Product_Name);
              return true;
            })
            .slice(0, 5);

          samoteProducts.forEach(product => {
            console.log(`Product ID for ${product.Product_Name}: ${product.Product_ID}`);
            const productElement = document.createElement('a');
            productElement.classList.add('product');
            productElement.href = `detail.html?id=${product.Product_ID}`;

            const productImage = document.createElement('img');
            productImage.src = product.Product_Img;
            productImage.alt = product.Product_Name;

            const productName = document.createElement('p');
            productName.classList.add('product-name');
            productName.textContent = product.Product_Name;

            const productPrice = document.createElement('p');
            productPrice.classList.add('product-price');
            productPrice.textContent = `฿${product.Price}`;

            productElement.appendChild(productImage);
            productElement.appendChild(productName);
            productElement.appendChild(productPrice);

            productContainer.appendChild(productElement);
          });
        })
        .catch(error => console.error('Error fetching products:', error));
    }

    window.onload = fetchProducts;
  </script>

  <!-- โหลด Google Maps API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmIbdkyjrg228uUkWH1-bSd0St0AGzuXM&callback=initMap">
    </script>

</body>

</html>
